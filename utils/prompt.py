def build_prompt(price, bids, asks, prev_price):
    print("ğŸ§  build_prompt é–‹å§‹")

    # å·®åˆ†è¨ˆç®—
    diff = price - prev_price
    rate = (diff / prev_price) * 100 if prev_price != 0 else 0
    direction = "ä¸Šæ˜‡" if diff > 0 else "ä¸‹è½" if diff < 0 else "å¤‰åŒ–ãªã—"

    # æ¿æƒ…å ±ã‹ã‚‰ä¾¡æ ¼ã‚’æ•°å€¤ã«å¤‰æ›
    bid_price = float(bids[0]['price'])
    ask_price = float(asks[0]['price'])
    spread = ask_price - bid_price

    prompt = f"""
ã‚ãªãŸã¯ãƒ—ãƒ­ã®æš—å·è³‡ç”£ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ã§ã™ã€‚
ETH/JPYã®ä¾¡æ ¼ãƒ»æ¿æƒ…å ±ãƒ»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ãƒ»ä¾¡æ ¼å¤‰åŒ–ãƒ»çŸ­æœŸãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ãªã©ã‚’è€ƒæ…®ã—ã€
ä»¥ä¸‹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å¾“ã£ã¦ã€1ã¤ã®æœ€é©æˆ¦ç•¥ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€‘
---
ğŸ“Š ETH/JPY æˆ¦ç•¥é€šçŸ¥ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰

- ğŸ’° ç¾åœ¨ä¾¡æ ¼ï¼š{price:,.0f}å††  
- ğŸ”„ ç›´è¿‘ã¨ã®ä¾¡æ ¼å¤‰åŒ–ï¼š{direction}ï¼ˆ{diff:+,.1f}å††ï¼{rate:+.2f}%ï¼‰  
- ğŸ“‰ æ¿æƒ…å ±ï¼šè²·ã„æ¿ {bid_price:,.0f}å†† ï¼ å£²ã‚Šæ¿ {ask_price:,.0f}å††  
- ğŸ“ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ï¼š{spread:,.0f}å††  
- ğŸ“ˆ æˆ¦ç•¥åˆ¤æ–­ï¼šãƒ­ãƒ³ã‚°ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼ã‚·ãƒ§ãƒ¼ãƒˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼æ§˜å­è¦‹ï¼ˆã„ãšã‚Œã‹1ã¤ï¼‰  
- ğŸ¯ åˆ©ç¢ºãƒ©ã‚¤ãƒ³ï¼šç¾åœ¨ã®ä¾¡æ ¼ã¨ç›¸å ´çŠ¶æ³ã‹ã‚‰é©åˆ‡ãªä¾¡æ ¼ã‚’äºˆæ¸¬ã—ã¦è¨˜å…¥ã—ã¦ãã ã•ã„  
- â›‘ï¸ ãƒ­ã‚¹ã‚«ãƒƒãƒˆãƒ©ã‚¤ãƒ³ï¼šãƒªã‚¹ã‚¯ç®¡ç†ã‚’è€ƒæ…®ã—ã¦è¨˜å…¥ã—ã¦ãã ã•ã„  

ğŸ§  ç†ç”±ï¼šæ¿ã®åšã•ã€ä¾¡æ ¼æ¨ç§»ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã€çŸ­æœŸãƒˆãƒ¬ãƒ³ãƒ‰ãªã©ã‚’åŠ å‘³ã—ã¦ã€1ã€œ2æ–‡ã§åˆ¤æ–­æ ¹æ‹ ã‚’è¿°ã¹ã¦ãã ã•ã„ã€‚
---

ã€è£œè¶³ã€‘
- ä¸Šä½3ä»¶ æ¿æƒ…å ±ï¼š
    ğŸŸ© Bids: {bids[:3]}
    ğŸŸ¥ Asks: {asks[:3]}
- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰å¹…ï¼š{spread:,.0f}å††

â€»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä»¥å¤–ã®å‡ºåŠ›ã¯ç¦æ­¢ã€‚å½¢å¼ã‚’å®ˆã£ã¦ç°¡æ½”ã«å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
"""

    return prompt.strip()
